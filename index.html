<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>드래그 앤 드롭 예제</title>
  <style>
    .container {
      width: 300px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    .draggable-item {
      padding: 10px;
      margin: 5px 0;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      cursor: grab;
    }
    .drop-zone {
      border: 1px dashed #007bff;
      border-radius: 5px;
      padding: 10px;
      min-height: 50px;
      display: flex;
      flex-direction: column;
    }
    .placeholder {
      height: 40px;
      margin: 5px 0;
      background-color: rgba(0, 123, 255, 0.3);
      border-radius: 5px;
    }
    .hidden {
      visibility: hidden; /* 드래그 중인 요소를 시각적으로 숨기기 */
      position: absolute;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="drop-zone" id="dropZone">
      <div class="draggable-item" draggable="true">항목 1</div>
      <div class="draggable-item" draggable="true">항목 2</div>
      <div class="draggable-item" draggable="true">항목 3</div>
      <div class="draggable-item" draggable="true">항목 4</div>
    </div>
  </div>

  <script>
    // 드래그 중인 요소와 플레이스홀더를 저장할 변수
    let draggedItem = null;
    let placeholder = document.createElement('div'); 
    placeholder.classList.add('placeholder');

    // 드롭 영역 (dropZone) 가져오기
    const $dropZone = document.getElementById('dropZone');

    // 드래그 시작 이벤트 - 드래그 중인 요소 숨기기
    $dropZone.addEventListener('dragstart', (e) => {
      draggedItem = e.target.closest('.draggable-item'); // 드래그 중인 요소 저장
      setTimeout(() => draggedItem.classList.add('hidden'), 0); // 요소를 숨기기 위해 클래스를 추가
    });

    // 드래그 종료 이벤트 - 드래그가 끝나면 원래 자리로 되돌리기
    $dropZone.addEventListener('dragend', (e) => {
      draggedItem.classList.remove('hidden'); // 숨겨진 요소 다시 표시
      placeholder.remove(); // 드래그 완료 후 플레이스홀더 제거
      draggedItem = null; // 드래그 중인 요소 초기화
    });

    // 드래그 오버 이벤트 - 드래그 중에 아이템을 다른 아이템 위에 올릴 때 발생
    $dropZone.addEventListener('dragover', (e) => {
      e.preventDefault(); // 기본 브라우저 동작을 막아 드롭 가능하게 설정
      const target = e.target; // 드래그 오버 중인 요소를 타겟으로 설정

      // 현재 마우스 위치에 따라 플레이스홀더 위치 설정
      if (target.classList.contains('draggable-item') && target !== draggedItem) {
        const bounding = target.getBoundingClientRect(); // 대상 요소의 크기와 위치 정보 가져오기
        const offset = e.clientY - bounding.top; // 마우스와 요소 상단 간의 거리 계산

        // 마우스 위치가 요소의 상/하 절반에 따라 플레이스홀더 위치 결정
        if (offset < bounding.height / 2) {
          target.before(placeholder); // 절반 위쪽일 경우 앞에 삽입
        } else {
          target.after(placeholder); // 절반 아래쪽일 경우 뒤에 삽입
        }
      } 
     
    });

    // 드롭 이벤트 - 드롭 위치에 드래그한 요소 배치
    $dropZone.addEventListener('drop', (e) => {
      e.preventDefault(); // 기본 동작 방지하여 드롭 설정 가능
      // 플레이스홀더가 바로 앞이나 뒤에 있을 경우 이동하지 않음
      if (draggedItem === placeholder.nextElementSibling || draggedItem === placeholder.previousElementSibling) {
        placeholder.remove(); // 필요 없는 경우 플레이스홀더 제거
      } else {
        placeholder.replaceWith(draggedItem); // 플레이스홀더 위치에 드래그한 요소 추가
      }
    });
  </script>

</body>
</html>